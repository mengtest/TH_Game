local json = require"lib.json"

tb = GlobalTb

function ConfirmButton()
    -- 这两个是通过injection设置过来的
    local name = nameInput.text
    local pwd = pwdInput.text

    if #name == 0 then
        CS.Global.Log("没有账号我怎么知道您是哪位？")
        return
    end
    
    if #pwd == 0 then
        CS.Global.Log("您是否忘记输入密码？")
        return
    end

    --@RefType [luaIde#CS.UnityEngine.GameObject]
    local ani, animaId = CS.Manager.Animation.Play("Effect/loading/", 0.1, 13, 24, -1, 0, nil)
    ani.transform:SetParent(CS.Global.GetRootObject("UILayer").transform)
    ani.transform.localPosition = CS.UnityEngine.Vector3(0, -180, 0)
    tb.animaId = animaId

    CS.Net.NetHelper.GetInstance():Login(name, pwd, "loginCallback")
end

function CancelButton()
    coroutine.resume(tb.closeDialogThread2)
end

function loginCallback(res, type, msg)
    local data = json.decode(res)
    -- print(data)
    -- print(data.res)
    -- if data.res then
        CS.Global.Log(data.msg.."欢迎"..data.uid.."的用户："..data.nickname)
        coroutine.resume(tb.closeDialogThread)
        CS.Manager.Animation.Stop(tb.animaId)
    -- end
    --     CS.Manager.Animation.Stop(tb.animaId)
    --     coroutine.resume(tb.closeDialogThread2)
    --     CS.Global.Log(data.msg)
    -- end
end